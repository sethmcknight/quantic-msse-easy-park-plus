sequenceDiagram
    participant V as Vehicle
    participant G as Entry Gate
    participant PO as Parking Operations
    participant VS as Vehicle Service
    participant RS as Reservation Service
    participant AS as Administration Service
    participant BS as Billing Service

    V->>G: Approaches entry gate
    G->>PO: Vehicle detected with plate recognition
    PO->>VS: Check vehicle status
    VS-->>PO: Vehicle status (Active/Banned)

    alt Vehicle is banned
        PO-->>G: Deny entry
        G-->>V: Gate remains closed
    else Vehicle is allowed
        PO->>RS: Check for active reservation
        RS-->>PO: Reservation details (if exists)

        PO->>AS: Request available slot
        AS->>AS: Find suitable slot based on vehicle category
        AS-->>PO: Assigned slot details

        PO->>PO: Create new Visit
        PO->>PO: Update slot status to Occupied

        alt Has reservation
            PO->>RS: Mark reservation as fulfilled
            RS-->>PO: Confirmation
        end

        PO-->>G: Authorize entry
        G->>G: Open gate
        G-->>V: Entry granted

        PO->>BS: Notify visit started (for billing preparation)
        BS-->>PO: Acknowledgment

        Note over PO: Visit status: ActiveInLot
    end