stateDiagram-v2
    [*] --> Requested : User initiates charging
    
    Requested --> PluggedIn_WaitingForVehicle : Charger connected
    Requested --> Cancelled : Connection failed/timeout
    
    PluggedIn_WaitingForVehicle --> ChargingInProgress : Vehicle accepts charge
    PluggedIn_WaitingForVehicle --> Faulted : Vehicle/charger fault
    PluggedIn_WaitingForVehicle --> Cancelled : User cancels
    
    ChargingInProgress --> ChargingComplete_GracePeriodActive : Charging finished
    ChargingInProgress --> Faulted : Fault during charging
    ChargingInProgress --> Cancelled : User stops charging
    
    ChargingComplete_GracePeriodActive --> ChargingComplete_IdleDetected : Grace period expires
    ChargingComplete_GracePeriodActive --> Unplugged_SessionEnded : User unplugs within grace
    
    ChargingComplete_IdleDetected --> Unplugged_SessionEnded : User finally unplugs
    
    Unplugged_SessionEnded --> [*]
    Faulted --> [*]
    Cancelled --> [*]
    
    note right of ChargingInProgress
        Tracking:
        - Energy consumption
        - Power output
        - Session duration
    end note
    
    note right of ChargingComplete_GracePeriodActive
        Grace period prevents
        immediate idle fees
    end note
    
    note right of ChargingComplete_IdleDetected
        Idle fees may apply
        based on lot policy
    end note